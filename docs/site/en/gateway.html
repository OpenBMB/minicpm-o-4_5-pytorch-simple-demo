<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Gateway - MiniCPM-o 4.5 Docs</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
<style>
* { margin:0; padding:0; box-sizing:border-box; }
:root {
  --sidebar-w: 260px;
  --bg: #fff; --bg-side: #f8f9fa; --bg-code: #f6f8fa;
  --c1: #24292f; --c2: #57606a;
  --border: #d0d7de; --accent: #0969da; --nav-active: #ddf4ff;
}
body { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans",Helvetica,Arial,sans-serif; color:var(--c1); line-height:1.6; background:var(--bg); }
.sidebar-toggle { position:fixed; top:12px; left:12px; z-index:1001; background:var(--bg-side); border:1px solid var(--border); border-radius:6px; padding:6px 10px; font-size:18px; cursor:pointer; display:none; }
.sidebar { position:fixed; top:0; left:0; width:var(--sidebar-w); height:100vh; overflow-y:auto; background:var(--bg-side); border-right:1px solid var(--border); padding:20px 0; z-index:1000; transition:transform .3s; }
.sidebar-header { padding:0 20px 16px; border-bottom:1px solid var(--border); margin-bottom:8px; }
.sidebar-header h2 { font-size:16px; font-weight:600; }
.sidebar-subtitle { font-size:12px; color:var(--c2); }
.lang-switch { display:inline-block; margin-top:6px; font-size:12px; color:var(--accent); text-decoration:none; padding:2px 8px; border:1px solid var(--border); border-radius:4px; transition:background .15s; }
.lang-switch:hover { background:var(--nav-active); text-decoration:none; }

.nav-list { list-style:none; padding:0 8px; }
.nav-list > li > a { display:block; padding:7px 12px; color:var(--c2); text-decoration:none; font-size:14px; border-radius:6px; transition:background .15s,color .15s; }
.nav-list > li > a:hover { background:#e8e8e8; color:var(--c1); }
.nav-list > li > a.active { background:var(--nav-active); color:var(--accent); font-weight:600; }

.nav-group { margin-top:4px; }
.nav-group-header { display:flex; align-items:center; gap:6px; padding:8px 12px; color:var(--c1); font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:.04em; cursor:pointer; border-radius:6px; user-select:none; transition:background .15s; }
.nav-group-header:hover { background:#eaeef2; }
.nav-group-header::before { content:""; display:inline-block; width:0; height:0; border-left:5px solid var(--c2); border-top:3.5px solid transparent; border-bottom:3.5px solid transparent; transition:transform .2s; transform:rotate(90deg); flex-shrink:0; }
.nav-group.collapsed .nav-group-header::before { transform:rotate(0); }
.nav-group-children { list-style:none; margin:0 0 4px 19px; padding:3px 0 3px 13px; border-left:2px solid #e1e4e8; overflow:hidden; max-height:500px; transition:max-height .25s ease,opacity .2s ease,padding .2s ease; opacity:1; }
.nav-group.collapsed .nav-group-children { max-height:0; opacity:0; padding:0 0 0 13px; }
.nav-group-children li a { display:block; padding:4px 10px; font-size:13px; color:var(--c2); text-decoration:none; border-radius:4px; transition:background .15s,color .15s; }
.nav-group-children li a:hover { background:#e8e8e8; color:var(--c1); }
.nav-group-children li a.active { background:var(--nav-active); color:var(--accent); font-weight:600; }

.content { margin-left:var(--sidebar-w); max-width:900px; padding:40px 48px; }
article h1 { font-size:28px; font-weight:600; padding-bottom:10px; border-bottom:1px solid var(--border); margin-bottom:20px; }
article h2 { font-size:22px; font-weight:600; margin-top:32px; margin-bottom:12px; padding-bottom:6px; border-bottom:1px solid #eaecef; }
article h3 { font-size:18px; font-weight:600; margin-top:24px; margin-bottom:10px; }
article h4 { font-size:15px; font-weight:600; margin-top:20px; margin-bottom:8px; }
article p { margin-bottom:14px; }
article ul,article ol { margin-bottom:14px; padding-left:24px; }
article li { margin-bottom:4px; }
article a { color:var(--accent); text-decoration:none; }
article a:hover { text-decoration:underline; }
article code { background:var(--bg-code); padding:2px 6px; border-radius:4px; font-size:13px; font-family:"SFMono-Regular",Consolas,"Liberation Mono",Menlo,monospace; }
article pre { background:var(--bg-code); border:1px solid var(--border); border-radius:6px; padding:16px; overflow-x:auto; margin-bottom:16px; line-height:1.5; }
article pre code { background:none; padding:0; font-size:13px; }
article table { width:100%; border-collapse:collapse; margin-bottom:16px; font-size:14px; }
article th,article td { border:1px solid var(--border); padding:8px 12px; text-align:left; }
article th { background:var(--bg-code); font-weight:600; }
article tr:nth-child(even) { background:#f8f9fa; }
article hr { border:none; border-top:1px solid var(--border); margin:28px 0; }
article blockquote { border-left:4px solid var(--accent); padding:8px 16px; margin:0 0 16px; color:var(--c2); background:#f8f9fa; border-radius:0 6px 6px 0; }
article .mermaid { text-align:center; margin:20px 0; }
footer { margin-top:60px; padding-top:16px; border-top:1px solid var(--border); color:var(--c2); font-size:13px; }
@media(max-width:768px) {
  .sidebar { transform:translateX(-100%); }
  .sidebar.open { transform:translateX(0); box-shadow:2px 0 8px rgba(0,0,0,.15); }
  .sidebar-toggle { display:block; }
  .content { margin-left:0; padding:50px 20px 40px; }
  .content.shifted { margin-left:var(--sidebar-w); }
}
</style>
</head>
<body>
<button class="sidebar-toggle" onclick="toggleSidebar()" aria-label="Toggle sidebar">&#9776;</button>
<nav class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <h2>MiniCPM-o 4.5</h2>
    <span class="sidebar-subtitle">Documentation</span>
    <a href="../zh/gateway.html" class="lang-switch">中文</a>
  </div>
  <ul class="nav-list">
    <li><a href="index.html">Overview</a></li>
    <li class="nav-group">
      <span class="nav-group-header">Architecture</span>
      <ul class="nav-group-children">
        <li><a href="architecture/index.html">Overview</a></li>
        <li><a href="architecture/streaming.html">Chat Mode</a></li>
        <li><a href="architecture/duplex.html">Duplex Mode</a></li>
        <li><a href="architecture/internals.html">Internals</a></li>
      </ul>
    </li>
    <li><a href="gateway.html" class="active">Gateway</a></li>
    <li><a href="worker.html">Worker</a></li>
    <li><a href="schema.html">Schema</a></li>
    <li><a href="model.html">Model</a></li>
    <li><a href="compile.html">torch.compile</a></li>
    <li class="nav-group">
      <span class="nav-group-header">Frontend</span>
      <ul class="nav-group-children">
        <li><a href="frontend/index.html">Overview</a></li>
        <li><a href="frontend/pages.html">Pages & Routes</a></li>
        <li><a href="frontend/audio.html">Audio</a></li>
        <li><a href="frontend/duplex-session.html">Duplex Session</a></li>
        <li><a href="frontend/components.html">UI Components</a></li>
      </ul>
    </li>
    <li><a href="api.html">API Reference</a></li>
    <li><a href="deployment.html">Deployment</a></li>
  </ul>
</nav>
<main class="content" id="content">
  <article><h1 id="gateway-module-details">Gateway Module Details</h1>
<p>The Gateway is the system's request entry point and routing hub. It does not load models and is responsible for request dispatching, WebSocket proxying, queue management, and resource management.</p>
<h2 id="module-structure">Module Structure</h2>
<div class="codehilite"><pre><span></span><code><span class="n">gateway</span><span class="p">.</span><span class="n">py</span><span class="w">                         </span><span class="p">#</span><span class="w"> </span><span class="n">Gateway</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">service</span>
<span class="n">gateway_modules</span><span class="o">/</span>
<span class="err">├──</span><span class="w"> </span><span class="n">__init__</span><span class="p">.</span><span class="n">py</span><span class="w">                    </span><span class="p">#</span><span class="w"> </span><span class="n">Package</span><span class="w"> </span><span class="n">identifier</span>
<span class="err">├──</span><span class="w"> </span><span class="n">worker_pool</span><span class="p">.</span><span class="n">py</span><span class="w">                 </span><span class="p">#</span><span class="w"> </span><span class="n">WorkerPool</span><span class="w"> </span><span class="n">scheduler</span>
<span class="err">├──</span><span class="w"> </span><span class="n">app_registry</span><span class="p">.</span><span class="n">py</span><span class="w">                </span><span class="p">#</span><span class="w"> </span><span class="n">Application</span><span class="w"> </span><span class="n">registry</span>
<span class="err">├──</span><span class="w"> </span><span class="n">models</span><span class="p">.</span><span class="n">py</span><span class="w">                      </span><span class="p">#</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="n">definitions</span>
<span class="err">└──</span><span class="w"> </span><span class="n">ref_audio_registry</span><span class="p">.</span><span class="n">py</span><span class="w">          </span><span class="p">#</span><span class="w"> </span><span class="n">Reference</span><span class="w"> </span><span class="n">audio</span><span class="w"> </span><span class="n">registry</span>
</code></pre></div>

<h2 id="gatewaypy-main-service">gateway.py — Main Service</h2>
<p>The Gateway is built on <strong>FastAPI</strong> and runs with <strong>uvicorn</strong>, providing HTTP REST API and WebSocket endpoints.</p>
<h3 id="lifecycle-management">Lifecycle Management</h3>
<p>The <code>lifespan()</code> async context manager is responsible for:
1. Loading configuration from <code>config.py</code>
2. Initializing <code>WorkerPool</code> and starting health checks
3. Initializing <code>RefAudioRegistry</code> and <code>AppRegistry</code>
4. Starting background session cleanup tasks (runs once daily)
5. Configuring HTTPS (self-signed certificate) or HTTP mode</p>
<h3 id="core-routes">Core Routes</h3>
<h4 id="http-endpoints">HTTP Endpoints</h4>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Method</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/health</code></td>
<td>GET</td>
<td>Health check</td>
</tr>
<tr>
<td><code>/status</code></td>
<td>GET</td>
<td>Global service status</td>
</tr>
<tr>
<td><code>/workers</code></td>
<td>GET</td>
<td>Worker list</td>
</tr>
<tr>
<td><code>/api/chat</code></td>
<td>POST</td>
<td>Chat inference (stateless)</td>
</tr>
<tr>
<td><code>/api/streaming/stop</code></td>
<td>POST</td>
<td>Stop Streaming generation</td>
</tr>
<tr>
<td><code>/api/frontend_defaults</code></td>
<td>GET</td>
<td>Frontend default configuration</td>
</tr>
<tr>
<td><code>/api/presets</code></td>
<td>GET</td>
<td>System prompt preset list</td>
</tr>
<tr>
<td><code>/api/default_ref_audio</code></td>
<td>GET</td>
<td>Default reference audio</td>
</tr>
<tr>
<td><code>/api/assets/ref_audio</code></td>
<td>GET</td>
<td>Reference audio list</td>
</tr>
<tr>
<td><code>/api/assets/ref_audio/external</code></td>
<td>POST</td>
<td>Upload reference audio</td>
</tr>
<tr>
<td><code>/api/assets/ref_audio/{id}</code></td>
<td>DELETE</td>
<td>Delete reference audio</td>
</tr>
<tr>
<td><code>/api/queue</code></td>
<td>GET</td>
<td>Queue status</td>
</tr>
<tr>
<td><code>/api/queue/{ticket_id}</code></td>
<td>GET/DELETE</td>
<td>Query/cancel queue entry</td>
</tr>
<tr>
<td><code>/api/config/eta</code></td>
<td>GET/PUT</td>
<td>ETA configuration management</td>
</tr>
<tr>
<td><code>/api/cache</code></td>
<td>GET</td>
<td>KV Cache status</td>
</tr>
<tr>
<td><code>/api/sessions/{sid}</code></td>
<td>GET</td>
<td>Session metadata</td>
</tr>
<tr>
<td><code>/api/sessions/{sid}/recording</code></td>
<td>GET</td>
<td>Session recording data</td>
</tr>
<tr>
<td><code>/api/sessions/{sid}/assets/{rel}</code></td>
<td>GET</td>
<td>Session resource files</td>
</tr>
<tr>
<td><code>/api/sessions/{sid}/download</code></td>
<td>GET</td>
<td>Download session</td>
</tr>
<tr>
<td><code>/api/sessions/{sid}/upload-recording</code></td>
<td>POST</td>
<td>Upload frontend recording</td>
</tr>
<tr>
<td><code>/api/apps</code></td>
<td>GET</td>
<td>Enabled application list</td>
</tr>
<tr>
<td><code>/api/admin/apps</code></td>
<td>GET/PUT</td>
<td>Application management (Admin)</td>
</tr>
</tbody>
</table>
<h4 id="websocket-endpoints">WebSocket Endpoints</h4>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/ws/chat</code></td>
<td>Chat WebSocket proxy</td>
</tr>
<tr>
<td><code>/ws/duplex/{session_id}</code></td>
<td>Duplex full-duplex session proxy</td>
</tr>
</tbody>
</table>
<h3 id="websocket-proxy-mechanism">WebSocket Proxy Mechanism</h3>
<p><strong>Streaming Proxy</strong>:
1. Accepts client WebSocket connection
2. Enqueues the request via <code>WorkerPool.enqueue("chat")</code>
3. While queued, pushes <code>queued</code> / <code>queue_update</code> messages to the client
4. Once a Worker is obtained, establishes a WebSocket connection to the Worker
5. Forwards messages bidirectionally (client ↔ worker)
6. Releases the Worker upon completion</p>
<p><strong>Duplex Proxy</strong>:
1. Accepts client WebSocket connection
2. Enqueues the request via <code>WorkerPool.enqueue("omni_duplex" / "audio_duplex")</code>
3. Once a Worker is obtained, exclusively holds that Worker
4. Starts two parallel tasks: <code>client_to_worker</code> and <code>worker_to_client</code>
5. Cleans up and releases when the client disconnects or sends <code>stop</code></p>
<h3 id="security-measures">Security Measures</h3>
<ul>
<li>Session IDs are validated via regex <code>^[a-zA-Z0-9_-]{1,64}$</code> to prevent path traversal</li>
<li>Upload file size limit of 200MB</li>
<li>HTTPS enabled by default (self-signed certificate)</li>
</ul>
<hr />
<h2 id="worker_poolpy-workerpool-scheduler">worker_pool.py — WorkerPool Scheduler</h2>
<p>WorkerPool is the core scheduling component of the Gateway, managing all Worker connections and request dispatching.</p>
<h3 id="core-classes">Core Classes</h3>
<h4 id="workerconnection">WorkerConnection</h4>
<p>A Worker connection data class that maintains the state information for a single Worker.</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>url</code></td>
<td>str</td>
<td>Worker address</td>
</tr>
<tr>
<td><code>index</code></td>
<td>int</td>
<td>Worker index</td>
</tr>
<tr>
<td><code>status</code></td>
<td>GatewayWorkerStatus</td>
<td>Current status</td>
</tr>
<tr>
<td><code>current_task</code></td>
<td>str</td>
<td>Current task type</td>
</tr>
<tr>
<td><code>current_session_id</code></td>
<td>str</td>
<td>Current session ID</td>
</tr>
<tr>
<td><code>cached_hash</code></td>
<td>str</td>
<td>Cached history hash</td>
</tr>
<tr>
<td><code>busy_since</code></td>
<td>datetime</td>
<td>Busy since timestamp</td>
</tr>
</tbody>
</table>
<p>Key methods:
- <code>mark_busy(task, session_id)</code> — Mark as busy
- <code>mark_idle()</code> — Mark as idle, update <code>cached_hash</code>
- <code>update_duplex_status(status)</code> — Update Duplex status
- <code>to_info()</code> — Convert to API response model</p>
<h4 id="queueentry">QueueEntry</h4>
<p>A queue entry containing <code>ticket</code> (queue ticket), <code>future</code> (awaitable result), and <code>history_hash</code> (message history digest).</p>
<h4 id="etatracker">EtaTracker</h4>
<p>An ETA estimation tracker that combines baseline values with EMA (Exponential Moving Average) for dynamic wait time estimation.</p>
<ul>
<li><code>get_eta(task_type)</code> — Get estimated duration for a single task</li>
<li><code>record_duration(task_type, duration)</code> — Record actual duration, update EMA</li>
<li><code>update_config(config)</code> — Update baseline values</li>
</ul>
<h4 id="workerpool">WorkerPool</h4>
<table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>start()</code></td>
<td>Start health check loop</td>
</tr>
<tr>
<td><code>stop()</code></td>
<td>Stop and clean up</td>
</tr>
<tr>
<td><code>enqueue(task_type, history_hash)</code></td>
<td>Enqueue request, returns (ticket, future)</td>
</tr>
<tr>
<td><code>release_worker(worker_url, cached_hash)</code></td>
<td>Release Worker</td>
</tr>
<tr>
<td><code>cancel(ticket_id)</code></td>
<td>Cancel queued entry</td>
</tr>
<tr>
<td><code>get_ticket(ticket_id)</code></td>
<td>Query queue status</td>
</tr>
<tr>
<td><code>get_queue_status()</code></td>
<td>Queue snapshot</td>
</tr>
<tr>
<td><code>get_all_workers()</code></td>
<td>Worker list</td>
</tr>
</tbody>
</table>
<h3 id="fifo-queue-mechanism">FIFO Queue Mechanism</h3>
<p>The queue is implemented using <code>OrderedDict</code>. All request types (Chat / Streaming / Duplex) share a single unified queue to ensure fair first-come-first-served ordering.</p>
<p><strong>Enqueue flow</strong> (<code>enqueue()</code>):
1. First attempts immediate assignment — if an idle Worker is available, the <code>Future</code> resolves immediately and the request does not enter the queue
2. If no idle Worker is available, checks capacity (default 1000); rejects if full
3. Creates a <code>QueueEntry</code> (with <code>QueueTicket</code> + <code>asyncio.Future</code>) and appends to the tail of the OrderedDict</p>
<p><strong>Dispatch flow</strong> (<code>_dispatch_next()</code>) — the sole entry point for Worker assignment:
1. Takes the head entry from the queue
2. Matches an idle Worker based on request type (Streaming uses LRU routing, others use general routing)
3. If found → immediately calls <code>mark_busy()</code> + <code>future.set_result(worker)</code> + removes the head
4. Loops until no idle Workers remain or the queue is empty</p>
<p><strong>Trigger points</strong>: <code>_dispatch_next()</code> is triggered when a Worker is released, a queue entry is cancelled, or a health check restores a Worker to IDLE.</p>
<p><strong>Gateway ↔ Worker communication</strong>: The queue is only responsible for Worker assignment (deciding which Worker handles which request) and does not participate in data transfer. After the Gateway obtains a Worker reference, it communicates directly with the Worker's internal port (22400+) via HTTP (Chat: <code>POST /chat</code>) or WebSocket (Chat: <code>/ws/chat</code>, Duplex: <code>/ws/duplex</code>).</p>
<h3 id="eta-estimation">ETA Estimation</h3>
<p><code>EtaTracker</code> combines Admin-configured baseline values with runtime EMA (Exponential Moving Average) for dynamic wait time estimation:</p>
<ul>
<li>Each task type maintains independent baseline and EMA dynamic values</li>
<li>Uses EMA values when sufficient samples are available (default &gt;= 3), otherwise uses baseline values</li>
<li><code>_recalc_positions_and_eta()</code> uses a min-heap to simulate the dispatch chain, popping the earliest available Worker to assign to the queue head, precisely calculating wait times for each queued entry</li>
<li>ETA results are pushed to queued clients in real-time via WebSocket</li>
</ul>
<h3 id="health-checks">Health Checks</h3>
<p>Polls all Workers' <code>/health</code> endpoints every 10 seconds (<code>_health_check_loop()</code>), updating status. After health checks, triggers <code>_dispatch_next()</code> (Workers may have recovered from OFFLINE to IDLE).</p>
<p><strong>Gateway scheduling authority</strong>: When the Gateway has dispatched a task to a Worker (<code>_gateway_dispatched=True</code>), even if the Worker's <code>/health</code> temporarily reports <code>idle</code> (transient cleanup state), the Gateway will not downgrade it to IDLE, preventing erroneous assignment. <code>release_worker()</code> clears this flag, restoring health check authority.</p>
<hr />
<h2 id="app_registrypy-application-registry">app_registry.py — Application Registry</h2>
<p>Manages the enabled/disabled state of frontend applications, supporting runtime dynamic toggling.</p>
<h3 id="default-applications">Default Applications</h3>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th>Default State</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>turnbased</code></td>
<td>Turn-based Chat</td>
<td>Enabled</td>
</tr>
<tr>
<td><code>omni</code></td>
<td>Omnimodal Full-Duplex</td>
<td>Enabled</td>
</tr>
<tr>
<td><code>audio_duplex</code></td>
<td>Audio Full-Duplex</td>
<td>Enabled</td>
</tr>
</tbody>
</table>
<h3 id="appregistry-class">AppRegistry Class</h3>
<table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>is_enabled(app_id)</code></td>
<td>Check if an application is enabled</td>
</tr>
<tr>
<td><code>set_enabled(app_id, enabled)</code></td>
<td>Set enabled state</td>
</tr>
<tr>
<td><code>get_enabled_apps()</code></td>
<td>Get list of enabled applications</td>
</tr>
<tr>
<td><code>get_all_apps()</code></td>
<td>Get all applications (for Admin)</td>
</tr>
</tbody>
</table>
<p>Thread safety is ensured via <code>threading.Lock</code>.</p>
<hr />
<h2 id="modelspy-gateway-data-models">models.py — Gateway Data Models</h2>
<p>Defines all API data models for the Gateway layer, based on Pydantic.</p>
<h3 id="enumerations">Enumerations</h3>
<ul>
<li><strong>GatewayWorkerStatus</strong> — Worker status enum: <code>idle</code> / <code>busy_streaming</code> / <code>duplex_active</code> / <code>duplex_paused</code> / <code>offline</code></li>
</ul>
<h3 id="data-models">Data Models</h3>
<table>
<thead>
<tr>
<th>Model</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>WorkerInfo</code></td>
<td>Worker information (url, index, status, task, session_id, cached_hash, busy_since)</td>
</tr>
<tr>
<td><code>QueueTicket</code></td>
<td>Queue ticket (ticket_id, position, eta_seconds, task_type)</td>
</tr>
<tr>
<td><code>QueueTicketSummary</code></td>
<td>Brief ticket (ticket_id, position)</td>
</tr>
<tr>
<td><code>RunningTaskInfo</code></td>
<td>Running task (worker_url, task_type, session_id, started_at, elapsed_s)</td>
</tr>
<tr>
<td><code>QueueStatus</code></td>
<td>Queue snapshot (queue_length, entries, running)</td>
</tr>
<tr>
<td><code>ServiceStatus</code></td>
<td>Global status (total_workers, idle, busy, queue_length)</td>
</tr>
<tr>
<td><code>EtaConfig</code> / <code>EtaStatus</code></td>
<td>ETA configuration and status</td>
</tr>
<tr>
<td><code>WorkersResponse</code></td>
<td>Worker list response</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="ref_audio_registrypy-reference-audio-registry">ref_audio_registry.py — Reference Audio Registry</h2>
<p>Manages storage and metadata for TTS reference audio.</p>
<h3 id="refaudioregistry-class">RefAudioRegistry Class</h3>
<table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>upload(name, audio_data, source)</code></td>
<td>Upload reference audio (auto-normalizes to 16kHz mono 16-bit WAV)</td>
</tr>
<tr>
<td><code>get(audio_id)</code></td>
<td>Query audio information</td>
</tr>
<tr>
<td><code>get_file_path(audio_id)</code></td>
<td>Get file path</td>
</tr>
<tr>
<td><code>get_base64(audio_id)</code></td>
<td>Get Base64 encoding</td>
</tr>
<tr>
<td><code>list_all()</code></td>
<td>List all reference audio</td>
</tr>
<tr>
<td><code>delete(audio_id)</code></td>
<td>Delete reference audio</td>
</tr>
<tr>
<td><code>exists(audio_id)</code></td>
<td>Check if exists</td>
</tr>
</tbody>
</table>
<p>Audio uploads are automatically normalized using <code>librosa</code> + <code>soundfile</code>. Metadata is persisted to a JSON file.</p></article>
  <footer><p>MiniCPM-o 4.5 PyTorch Simple Demo &mdash; Generated by build_docs.py</p></footer>
</main>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
<script type="module">
import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
mermaid.initialize({startOnLoad:true,theme:'default',securityLevel:'loose'});
</script>
<script>
hljs.highlightAll();
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('open');document.getElementById('content').classList.toggle('shifted');}
document.querySelectorAll('.nav-group-header').forEach(function(h){h.addEventListener('click',function(){this.parentElement.classList.toggle('collapsed');});});
document.addEventListener('click',function(e){var s=document.getElementById('sidebar'),t=document.querySelector('.sidebar-toggle');if(window.innerWidth<=768&&s.classList.contains('open')&&!s.contains(e.target)&&!t.contains(e.target)){s.classList.remove('open');document.getElementById('content').classList.remove('shifted');}});
</script>
</body>
</html>
